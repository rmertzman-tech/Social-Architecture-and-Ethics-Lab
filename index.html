<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constructor Console | The Physics of Agency v4.6</title>
    <style>
        :root {
            --matrix-green: #00ff41; --void-black: #0d0208; --text-white: #f0fdf4;
            --danger-red: #ff3131; --gold: #ffd700; --panel-bg: #111827; --border: #22c55e;
        }
        body { font-family: 'Courier New', monospace; background: var(--void-black); color: var(--text-white); margin: 0; padding: 20px; line-height: 1.5; }
        .app-container { max-width: 1200px; margin: 0 auto; border: 2px solid var(--border); border-radius: 12px; box-shadow: 0 0 30px rgba(0, 255, 65, 0.2); background: rgba(13, 2, 8, 0.98); }
        
        header { padding: 2rem; border-bottom: 2px solid var(--border); text-align: center; background: linear-gradient(to bottom, #003b00, transparent); }
        h1 { margin: 0; font-size: 2.2rem; text-shadow: 0 0 15px var(--matrix-green); text-transform: uppercase; letter-spacing: 2px; }
        
        /* Tabs */
        .nav-tabs { display: flex; background: #000; border-bottom: 1px solid var(--border); }
        .nav-tabs button { flex: 1; padding: 1rem; border: none; background: none; color: var(--matrix-green); cursor: pointer; font-weight: bold; font-family: inherit; font-size: 1rem; transition: 0.3s; }
        .nav-tabs button.active { background: var(--panel-bg); color: white; border-bottom: 4px solid var(--matrix-green); }
        
        .panel { display: none; padding: 2rem; }
        .panel.active { display: block; }

        /* The Dashboard */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .card { border: 1px solid var(--border); padding: 1.5rem; border-radius: 8px; background: #000; position: relative; }
        .metric-box { border: 1px solid var(--border); padding: 1rem; text-align: center; background: #052e16; }
        .metric-val { font-size: 2.5rem; font-weight: 800; color: var(--matrix-green); }
        
        /* Sliders */
        .control-group { margin-bottom: 1.5rem; }
        .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .readout { color: var(--gold); font-weight: bold; background: #1e293b; padding: 2px 8px; border-radius: 4px; }
        input[type="range"] { width: 100%; accent-color: var(--matrix-green); cursor: pointer; }

        /* Awe & Nirvana */
        .awe-container { height: 12px; background: #111; border-radius: 6px; margin: 10px 0; border: 1px solid var(--gold); }
        #awe-bar { height: 100%; width: 0%; background: var(--gold); box-shadow: 0 0 15px var(--gold); transition: 0.5s ease-out; }
        .btn { width: 100%; padding: 15px; border: 2px solid var(--matrix-green); background: none; color: var(--matrix-green); font-weight: bold; cursor: pointer; font-family: inherit; margin-top: 10px; }
        .btn:hover { background: var(--matrix-green); color: black; }
        .btn-nirvana { border-color: var(--gold); color: var(--gold); }
        .btn-nirvana.active { background: var(--gold); color: black; box-shadow: 0 0 20px var(--gold); }

        /* Visualizer */
        canvas { width: 100%; height: 350px; background: #000; border: 1px solid var(--border); margin-top: 20px; border-radius: 4px; }
        
        /* Educational Content */
        .scenario-box { background: #052e16; border-left: 4px solid var(--gold); padding: 1.5rem; margin-bottom: 1.5rem; }
        .glossary-grid { display: grid; grid-template-columns: auto 1fr; gap: 10px 20px; }
        dt { color: var(--matrix-green); font-weight: bold; margin-top: 10px; }
        dd { margin: 0 0 10px 0; color: #cbd5e1; }

        .alert-box { display: none; color: var(--danger-red); border: 1px solid var(--danger-red); padding: 1rem; text-align: center; font-weight: bold; margin-top: 10px; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h1>Constructor Console v4.6</h1>
        <p>Single-Agent Invariant Set Simulation</p>
    </header>

    <nav class="nav-tabs" role="tablist">
        <button class="active" onclick="openTab(event, 'sim')">1. The Lab</button>
        <button onclick="openTab(event, 'theory')">2. Deep Theory</button>
        <button onclick="openTab(event, 'scenarios')">3. Scenarios</button>
        <button onclick="openTab(event, 'glossary')">4. Definitions</button>
    </nav>

    <div id="sim" class="panel active">
        <div class="grid">
            <div class="card">
                <h2>Thermodynamic Controls</h2>
                <div class="control-group">
                    <div class="label-row">
                        <label for="entropy">Internalized Stress ($L_{GC}$)</label>
                        <span id="entropy-readout" class="readout">0.30</span>
                    </div>
                    <input type="range" id="entropy" min="0.05" max="1" step="0.01" value="0.30" oninput="runSim()">
                </div>
                <div class="control-group">
                    <div class="label-row">
                        <label for="budget">Metabolic Budget ($W$)</label>
                        <span id="budget-readout" class="readout">50</span>
                    </div>
                    <input type="range" id="budget" min="1" max="100" step="1" value="50" oninput="runSim()">
                </div>
                <button class="btn btn-nirvana" id="nirvana-btn" onclick="toggleNirvana()">Nirvana Protocol: Offline</button>
            </div>

            <div class="card">
                <h2>Real-Time Agential Metrics</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <div class="metric-box" style="flex:1">
                        <span style="font-size: 0.7rem; text-transform: uppercase;">Logical Depth ($\mathcal{L}$)</span>
                        <div id="depth-val" class="metric-val">12.0</div>
                    </div>
                    <div class="metric-box" style="flex:1">
                        <span style="font-size: 0.7rem; text-transform: uppercase;">Coherence ($\lambda$)</span>
                        <div id="lambda-val" class="metric-val">0.95</div>
                    </div>
                </div>
                
                <label>Authenticity Signal (The Awe Meter)</label>
                <div class="awe-container"><div id="awe-bar"></div></div>
                
                <div id="status-alert" class="alert-box">WARNING: AGENTIAL COLLAPSE - SAPOLSKY LIMIT EXCEEDED</div>
                <button class="btn" style="margin-top:20px; border-color: #475569; color: #94a3b8;" onclick="downloadReport()">Download Ethics Audit Report</button>
            </div>
        </div>

        <div class="card" style="margin-top: 2rem;">
            <h2>The P-Adic Tree of Agency</h2>
            <p>Visualizing the <strong>CIB Trajectory</strong>. Your current <strong>Stress Threshold</strong> is based on your <strong>Budget</strong>.</p>
            <canvas id="treeCanvas"></canvas>
        </div>
    </div>

    <div id="theory" class="panel">
        <h2>Unifying the Second Law across Life</h2>
        <div class="scenario-box">
            <h3>The Equation: $S_{thermo} = S_{agent} + S_{waste}$</h3>
            <p><strong>Total Entropy ($S_{thermo}$):</strong> The inevitable disorder of the universe.</p>
            <p><strong>Agential Entropy ($S_{agent}$):</strong> The specific disordering of an agent's internal structure. Long before biological death, an agent can suffer "Agential Death" when they lose the ability to maintain their CIB.</p>
            <p><strong>Heat ($S_{waste}$):</strong> The disorder exported to the environment to maintain internal coherence.</p>
        </div>
    </div>

    <div id="scenarios" class="panel">
        <h2>Agential Physics Scenarios</h2>
        <div class="scenario-box">
            <strong>1. The Fragile Agent</strong>
            <p>Set <strong>Budget</strong> to 10. Gradually increase <strong>Stress</strong>. Notice the tree turns red (truncates) at only ~0.50 stress. Without a buffer, agency is fragile.</p>
        </div>
        <div class="scenario-box">
            <strong>2. The Resilient Meta-Constructor</strong>
            <p>Set <strong>Budget</strong> to 90. Increase <strong>Stress</strong> to 0.80. The tree stays blue. With high metabolic resources, the agent can "process" the Matrix without collapsing into survival mode.</p>
        </div>
    </div>

    <div id="glossary" class="panel">
        <h2>Glossary of Terms</h2>
        <dl class="glossary-grid">
            <dt>Internalized Stress ($L_{GC}$)</dt>
            <dd>The "Noise" slider. This is <strong>not</strong> an objective measure of the room, but the agent's subjective experience. It is how much chaos successfully bypassed the agent's perception filters.</dd>
            
            <dt>Dynamic Sapolsky Limit</dt>
            <dd>The point where ethics and nuance go offline. In this app, the threshold shifts: $0.45 + (Budget / 200)$. More budget = more resilience.</dd>

            <dt>CIB</dt><dd>Conceptual Integrative Blueprint. The hierarchical software structure of the self.</dd>
            
            <dt>Truncation</dt><dd>When internalized stress exceeds the metabolic threshold, forcing the agent to erase "Logical Depth" to save energy.</dd>
        </dl>
    </div>
</div>

<script>
    let nirvanaActive = false;
    const canvas = document.getElementById('treeCanvas');
    const ctx = canvas.getContext('2d');
    
    function resize() {
        canvas.width = canvas.parentElement.clientWidth - 50;
        canvas.height = 350;
    }
    window.onresize = resize;
    resize();

    function openTab(evt, tabId) {
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        evt.currentTarget.classList.add('active');
        if(tabId === 'sim') runSim();
    }

    function toggleNirvana() {
        nirvanaActive = !nirvanaActive;
        const btn = document.getElementById('nirvana-btn');
        btn.innerText = nirvanaActive ? "Nirvana Protocol: ACTIVE" : "Nirvana Protocol: Offline";
        btn.classList.toggle('active');
        runSim();
    }

    function runSim() {
        let noise = parseFloat(document.getElementById('entropy').value);
        let budget = parseFloat(document.getElementById('budget').value);
        
        document.getElementById('entropy-readout').innerText = noise.toFixed(2);
        document.getElementById('budget-readout').innerText = budget;

        if(nirvanaActive) noise *= 0.15; 

        // AGENTIAL PHYSICS: Dynamic Threshold logic
        // Baseline 0.45 + 0.05 for every 10 units of budget
        let dynamicThreshold = 0.45 + (budget / 200);

        // Calculate Metrics
        let rawDepth = budget / (1.5 * Math.max(0.1, noise));
        let displayDepth = Math.min(20, rawDepth / 5);
        
        // Lambda collapse based on dynamic threshold
        let lambda = (1 / (1 + Math.exp(15 * (noise - dynamicThreshold)))) * Math.min(1, rawDepth / 20);
        
        document.getElementById('depth-val').innerText = displayDepth.toFixed(1);
        document.getElementById('lambda-val').innerText = Math.max(0, lambda).toFixed(2);

        // Awe Signal = proximity to the agent's "Sweet Spot"
        let awe = 100 - (Math.abs(noise - (dynamicThreshold - 0.2)) * 200);
        document.getElementById('awe-bar').style.width = Math.max(5, Math.min(100, awe)) + "%";

        const alert = document.getElementById('status-alert');
        const isCritical = (noise > dynamicThreshold);
        alert.style.display = isCritical ? "block" : "none";

        drawPAdicTree(noise, dynamicThreshold);
    }

    function drawPAdicTree(noise, thresh) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const isCritical = (noise > thresh);
        ctx.strokeStyle = isCritical ? '#ff3131' : '#00ff41';
        ctx.shadowBlur = isCritical ? 15 : 5;
        ctx.shadowColor = ctx.strokeStyle;
        
        function drawBranch(x, y, len, angle, depth) {
            if (depth === 0) return;
            let x2 = x + Math.cos(angle) * len;
            let y2 = y + Math.sin(angle) * len;
            
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x2, y2);
            ctx.lineWidth = depth * 0.8;
            ctx.stroke();
            
            let drift = isCritical ? (Math.random() - 0.5) * 0.4 : 0;
            drawBranch(x2, y2, len * 0.75, angle - 0.4 + drift, depth - 1);
            drawBranch(x2, y2, len * 0.75, angle + 0.4 + drift, depth - 1);
        }
        
        drawBranch(canvas.width/2, canvas.height - 20, 70, -Math.PI/2, isCritical ? 4 : 8);
    }

    function downloadReport() {
        const report = `CONSTRUCTOR AUDIT\nNoise: ${document.getElementById('entropy').value}\nBudget: ${document.getElementById('budget').value}\nLambda: ${document.getElementById('lambda-val').innerText}`;
        const blob = new Blob([report], {type: 'text/plain'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `Audit_Report.txt`;
        a.click();
    }

    runSim();
</script>
</body>
</html>
